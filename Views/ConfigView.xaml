<UserControl x:Class="TimeTracker.Views.ConfigView"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:converters="clr-namespace:TimeTracker.Converters"
        xmlns:helpers="clr-namespace:TimeTracker.Helpers"
        xmlns:vm="clr-namespace:TimeTracker.ViewModels"
        xmlns:local="clr-namespace:TimeTracker.Views"
        xmlns:iconPacks="http://metro.mahapps.com/winfx/xaml/iconpacks"
        mc:Ignorable="d"
        Height="Auto" Width="Auto">
    <UserControl.Resources>
        <converters:NullToBoolConverter x:Key="NullToBool"/>
    </UserControl.Resources>

    <Border Background="#AAA" MaxHeight="720" Padding="12" CornerRadius="12" Style="{StaticResource ShadowedGridBorder}">
        <Grid MaxHeight="720">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <!-- Configuración de columnas -->
            <StackPanel Orientation="Horizontal" Margin="0,0,0,12" VerticalAlignment="Center">
                <TextBlock FontSize="14" Text="Max Columns" VerticalAlignment="Center"/>
                <TextBox Text="{Binding MaxColumns, UpdateSourceTrigger=PropertyChanged}" Width="50" Margin="8,0"/>
            </StackPanel>

            <!-- Lista de tareas -->
            <Grid Grid.Row="1">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>
                
                <TextBlock Grid.Row="0" FontSize="14" Text="Tasks" Margin="0,0,0,4"></TextBlock>

                <ListBox
                        Grid.Row="1"
                        Background="Transparent"
                        BorderThickness="0"
                        ItemsSource="{Binding Tasks}"
                        SelectedItem="{Binding SelectedTask}"
                        ScrollViewer.VerticalScrollBarVisibility="Auto">
                    <ListBox.ItemContainerStyle>
                        <Style TargetType="ListBoxItem">
                            <Setter Property="Padding" Value="0"/>
                            <Setter Property="Margin" Value="0"/>
                            <Setter Property="Background" Value="Transparent"/>
                            <Setter Property="BorderThickness" Value="0"/>
                            <Setter Property="HorizontalContentAlignment" Value="Stretch"/>

                            <Setter Property="Template">
                                <Setter.Value>
                                    <ControlTemplate TargetType="ListBoxItem">
                                        <Border x:Name="Root"
                                                Background="{TemplateBinding Background}"
                                                CornerRadius="6"
                                                Padding="4">
                                            <ContentPresenter/>
                                        </Border>

                                        <ControlTemplate.Triggers>
                                            <Trigger Property="IsSelected" Value="True">
                                                <Setter TargetName="Root" Property="Background" Value="#770055CC"/>
                                            </Trigger>

                                            <Trigger Property="IsMouseOver" Value="True">
                                                <Setter Property="Cursor" Value="Hand"/>
                                                <Setter TargetName="Root" Property="Background" Value="#440055CC"/>
                                            </Trigger>

                                            <Trigger Property="IsEnabled" Value="False">
                                                <Setter TargetName="Root" Property="Opacity" Value="0.5"/>
                                            </Trigger>
                                        </ControlTemplate.Triggers>
                                    </ControlTemplate>
                                </Setter.Value>
                            </Setter>
                        </Style>
                    </ListBox.ItemContainerStyle>
                    
                    <ListBox.ItemTemplate>
                        <DataTemplate>
                            <Grid Margin="2,4">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="10"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="6"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>

                                <Label Padding="0" VerticalAlignment="Center">
                                    <Label.Content>
                                        <iconPacks:FeatherIcons Kind="CheckCircle" Width="16" Height="16"/>
                                    </Label.Content>
                                </Label>

                                <TextBox Grid.Column="2" Text="{Binding Name, UpdateSourceTrigger=PropertyChanged}" Width="160"/>
                                
                                <TextBox helpers:ButtonHelper.CornerRadius="4,0,0,4" Grid.Column="4" Text="{Binding ColorHex, UpdateSourceTrigger=PropertyChanged}" Width="72"/>
                                <Border Style="{StaticResource ShadowedGridBorder}" Grid.Column="6" Width="20" Height="20" Background="{Binding Color}" CornerRadius="0,4,4,0"/>
                            </Grid>
                        </DataTemplate>
                    </ListBox.ItemTemplate>
                </ListBox>
            </Grid>

            <!-- Botones para gestión de tareas -->
            <StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Center" Margin="0,12,0,0">
                <Button Style="{StaticResource ButtonWithShadow}" Content="Añadir" Width="75" Margin="4" Command="{Binding AddTaskCommand}"/>
                <Button Style="{StaticResource ButtonWithShadow}" Content="Eliminar" Width="75" Margin="4" Command="{Binding RemoveTaskCommand}" IsEnabled="{Binding SelectedTask, Converter={StaticResource NullToBool}}"/>
            </StackPanel>
        </Grid>
    </Border>
</UserControl>
